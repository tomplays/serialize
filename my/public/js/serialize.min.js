!function(t){if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.Serialize=t()}}(function(){return function t(e,r,n){function s(a,p){if(!r[a]){if(!e[a]){var o="function"==typeof require&&require;if(!p&&o)return o(a,!0);if(i)return i(a,!0);throw new Error("Cannot find module '"+a+"'")}var u=r[a]={exports:{}};e[a][0].call(u.exports,function(t){var r=e[a][1][t];return s(r?r:t)},u,u.exports,t,e,r,n)}return r[a].exports}for(var i="function"==typeof require&&require,a=0;a<n.length;a++)s(n[a]);return s}({1:[function(t,e){"use strict";function r(t,e){return t.type!==e.type||t.type===s&&t.href!==e.href?!1:e.start<=t.end?(t.end=Math.max(t.end,e.end),t):!1}function n(t){var e,n;for(n=0;n<t.length-1;n+=1)e=r(t[n],t[n+1]),e&&(t.splice(n,2,e),n-=1);return t}var s=t("./types").link;e.exports=n},{"./types":7}],2:[function(t,e){"use strict";function r(t,e){for(var r,s,i=t.firstChild,a=0,p=0;i;)if(i.nodeType!==Node.ELEMENT_NODE){if(a+i.data.length>e.start?(a<e.start&&(s=i.splitText(e.start-a),a+=i.data.length,i=s),a+i.data.length>e.end&&i.splitText(e.end-a),r=n(e),i.parentNode.replaceChild(r,i),r.appendChild(i),a+=i.data.length,i=r):a+=i.data.length,a>=e.end)break;for(;!i.nextSibling&&p;)p-=1,i=i.parentNode;i=i.nextSibling}else i=i.firstChild,p+=1}var n=t("./inline").createInline;e.exports=r},{"./inline":4}],3:[function(t,e){"use strict";function r(t){if(!(this instanceof r))return new r(t);if(!t||t.nodeType!==Node.ELEMENT_NODE)throw new TypeError("Serialize can only serialize element nodes.");var e,s,i=t.firstChild,a=[],p="",o=0;for(this.length=0,this.markups=[],this.type=t.nodeName.toLowerCase(),Object.defineProperty(this,"text",{configurable:!0,enumerable:!0,get:function(){return p},set:function(t){this.length=t.length,p=t}});i;)if(i.nodeType!==Node.ELEMENT_NODE){for(this.text+=i.data;!i.nextSibling&&o;){for(e=a.pop(),s=0;s<e.length;s+=1)e[s].end=this.length;this.addMarkups(e),o-=1,i=i.parentNode}i=i.nextSibling}else{if("BR"===i.nodeName&&(this.text+="\n"),!i.firstChild){for(;!i.nextSibling&&o;){for(e=a.pop(),s=0;s<e.length;s+=1)e[s].end=this.length;this.addMarkups(e),o-=1,i=i.parentNode}i=i.nextSibling;continue}for(e=n(i),s=0;s<e.length;s+=1)e[s].start=this.length;a.push(e),o+=1,i=i.firstChild}this.mergeAdjacent()}var n=t("./inline").serializeInline,s=t("./adjacent"),i=t("./applyMarkup"),a=t("./replaceNewlines"),p=t("./replace");r.prototype.addMarkups=function(t){var e;for(Array.isArray(t)||(t=[t]),e=0;e<t.length;e+=1)this._addMarkup(t[e]);return this},r.prototype._addMarkup=function(t){for(var e=0;this.markups[e]&&t.type>this.markups[e].type;)e+=1;for(;this.markups[e]&&t.type===this.markups[e].type&&t.start>this.markups[e].start;)e+=1;for(;this.markups[e]&&t.type===this.markups[e].type&&t.start===this.markups[e].start&&t.end>this.markups[e].end;)e+=1;return this.markups.splice(e,0,t),this},r.prototype.removeMarkup=function(t){var e,r,n,s;for(s=0;s<this.markups.length&&(e=this.markups[s],!(e.type>t.type));s+=1)if(e.type===t.type){if(e.start<=t.start&&e.end>=t.end)return r={type:e.type,start:e.start,end:t.start},n={type:e.type,start:t.end,end:e.end},void(n.start!==n.end&&r.start!==r.end?(this.markups.splice(s,1,r,n),s+=1):r.start!==r.end?this.markups[s]=r:n.start!==n.end?this.markups[s]=n:(this.markups.splice(s,1),s-=1));e.start>=t.start&&e.start<t.end&&(e.start=t.end),e.end>t.start&&e.end<=t.end&&(e.end=t.start),e.end<=e.start&&(this.markups.splice(s,1),s-=1)}return this},r.prototype.mergeAdjacent=function(){return this.markups=s(this.markups),this},r.prototype.replace=p,r.prototype.substr=function(t,e){var n,s,i,a=new r(document.createElement(this.type));if(!this.length||0>=e)return a;for(;0>t;)t=this.length+t;for(("undefined"==typeof e||t+e>this.length)&&(e=this.length-t),s=t+e,a.text=this.text.substr(t,e),i=0;i<this.markups.length;i+=1)n=this.markups[i],n.start<s&&n.end>t&&a._addMarkup({type:n.type,start:n.start>t?n.start-t:0,end:n.end<s?n.end-t:s-t});return a},r.prototype.substring=function(t,e){var r;return t>e&&(r=t,t=e,e=r),0>t&&(t=0),0>e&&(e=0),"undefined"==typeof e&&(e=this.length),this.substr(t,e-t)},r.prototype.append=function(t){var e,n,s,i;if(t){for(e=new r(document.createElement(this.type)),e.text=this.text+t.text,i=0;i<this.markups.length;i+=1)s=this.markups[i],n={type:s.type,start:s.start,end:s.end},e._addMarkup(n);for(i=0;i<t.markups.length;i+=1)s=t.markups[i],n={type:s.type,start:s.start+this.length,end:s.end+this.length},e._addMarkup(n);return e.mergeAdjacent(),e}},r.prototype.equals=function(t){var e,r,n,s,i;if(this.type!==t.type||this.text!==t.text||this.markups.length!==t.markups.length)return!1;for(s=0;s<this.markups.length;s+=1){if(e=t.markups[s],r=this.markups[s],n=Object.keys(r),n.length!==Object.keys(e).length)return!1;for(i=0;i<n.length;i+=1)if(r[n[i]]!==e[n[i]])return!1}return!0},r.prototype.toElement=function(){var t=document.createElement(this.type);return t.textContent=this.text,this.markups.forEach(function(e){i(t,e)}),a(t),t.normalize(),t},r.fromText=function(t,e){var r;return e=e||"p",r=new this(document.createElement(e)),r.text=t,r},r.fromJSON=function(t){var e=JSON.parse(t),r=new this(document.createElement("p"));if("string"!=typeof e.text||!e.type)throw new Error("Invalid JSON serialization.");return r.type=e.type,r.text=e.text,r.markups=e.markups||[],r},r.types=t("./types"),e.exports=r},{"./adjacent":1,"./applyMarkup":2,"./inline":4,"./replace":5,"./replaceNewlines":6,"./types":7}],4:[function(t,e,r){"use strict";var n=t("./types");r.serializeInline=function(t){var e=t.nodeName.toLowerCase(),r=[];return"a"===e?r.push({type:n.link,href:t.getAttribute("href")}):"code"===e?r.push({type:n.code}):/^(strong|b)$/.test(e)?r.push({type:n.bold}):/^(em|i)$/.test(e)&&r.push({type:n.italic}),/italic|oblique/.test(t.style.fontStyle)&&r.push({type:n.italic}),("bold"===t.style.fontWeight||t.style.fontWeight>=700)&&r.push({type:n.bold}),r},r.createInline=function(t){var e;switch(t.type){case n.link:e="a";break;case n.code:e="code";break;case n.bold:e="strong";break;case n.italic:e="em";break;default:throw new Error("Unknown markup type")}return e=document.createElement(e),t.type===n.link&&e.setAttribute("href",t.href),e}},{"./types":7}],5:[function(t,e){"use strict";function r(t,e,r){return r>t&&e>r}function n(t,e){var n=0;return this.text=this.text.replace(t,function(t){var s,i,a,p,o,u,l=arguments[arguments.length-1],h=arguments[arguments.length-2];if("function"==typeof e){if(o=e.apply(null,Array.prototype.slice.call(arguments)),o===!1||o===t)return t}else for(o="",u=0;u<e.length;u+=1)if(a=e[u],"$"===a){switch(a=e[u+1]){case"$":o+="$";break;case"&":o+=t;break;case"`":o+=l.substr(0,h);break;case"'":o+=l.substr(h+t.length);break;default:p=parseInt(a),o+=p&&p<=arguments.length-3?arguments[p]:"$"+a}u+=1}else o+=a;for(h-=n,s=t.length-o.length,n+=s,u=0;u<this.markups.length;u+=1)i=this.markups[u],r(h,h+t.length,i.start)?i.start=h+o.length:i.start>h&&(i.start-=s),r(h,h+t.length,i.end)?i.end=h:i.end>h&&(i.end-=s),i.end<=i.start?(this.markups.splice(u,1),u-=1):this.markups[u]=i;return o}.bind(this)),this}e.exports=n},{}],6:[function(t,e){"use strict";function r(t){for(var e,r=t.firstChild,n=0;r;)if(r.nodeType!==Node.ELEMENT_NODE){for(/\n/.test(r.data)&&(r.splitText(r.data.indexOf("\n")+1),e=r.splitText(r.data.length-1),e.parentNode.replaceChild(document.createElement("br"),e),r=r.nextSibling);!r.nextSibling&&n;)n-=1,r=r.parentNode;r=r.nextSibling}else r.firstChild?(n+=1,r=r.firstChild):r=r.nextSibling}e.exports=r},{}],7:[function(t,e){"use strict";var r={link:1,code:2,bold:3,italic:4};e.exports=r},{}]},{},[3])(3)});